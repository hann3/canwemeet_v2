{% extends 'base.html' %}

{% block content %}
<style>
  .n{
    color: transparent;
    background-color: transparent;
    border: 0;
  }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  
<script>  

function checkLoginStatus(){
  var nameTxt = document.querySelector('#name');
  var loginBtn = document.querySelector('#loginBtn');
  if(gauth.isSignedIn.get()){
    console.log('logined');
    loginBtn.value = 'logout';
    var profile = gauth.currentUser.get().getBasicProfile();
  console.log(profile.getName());
  console.log(profile.getId());
  console.log(profile.getEmail());
  setTimeout(function() {
    // 값이 콘솔에 찍히는지 확인하기 위해 딜레이 넣음
    location.href="main";
}, 3000);
  }
}
  function init() {
  gapi.load('auth2', function() {
    console.log('^ㅡ^auth2');
    window.gauth = gapi.auth2.init({
        client_id:'646888679664-oklga1e16gl0c5fcniv49b039v7qs4ok.apps.googleusercontent.com'
    })
    gauth.then(function(){
      console.log('ㅡ_ㅡgoogleAuth success');     
      checkLoginStatus();
    }, function(){
      console.log('googleAuth fail');
    });
  });
  }       

</script>
<body class="blue login">
    <main>
      <section id="logo">
        <img src="{{ url_for('static', filename='images/login/logo.png') }}" alt="캔위미트? 로고">
      </section>

      <section id="login-form">
        {{ csrf_token }}
        <div id="naverIdLogin">
            <img src="{{ url_for('static', filename='images/login/login-naver.png') }}" alt="네이버 로그인">
        </div>

        <div id="kakao">
          <a href="https://kauth.kakao.com/oauth/authorize?client_id=db3901148da54e8931540503043c6259&redirect_uri=http://localhost:5000/oauth&response_type=code&scope=talk_message">
            <img src="{{ url_for('static', filename='images/login/login-kakao.png') }}" alt="카카오 로그인">
          </a>
        </div>
        
        <div id="google">          
            <button type="button" id="loginBtn" value="login" class="n" onclick="
            if(this.value == 'login'){
              gauth.signIn().then(function(){
              console.log('gauth.signIn()');
              checkLoginStatus();
            });
            }">
            <img src="{{ url_for('static', filename='images/login/login-google.png') }}" alt="구글 로그인"></button>
        </div>  
      </section>

      <section id="phrase">
        <p>
          <span class="yellow-bold">세 번의 클릭</span>만으로<br>
          <span class="yellow-bold">회의를 시작</span>하세요!
        </p>        
      </section>

      <a href="/main">메인페이지 링크(테스트용)</a>
    </main>
<script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
</body>
{% endblock content %}

